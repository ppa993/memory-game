<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Memory Game</title>
        <!-- Tailwind CSS for modern styling -->
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
                body {
                        font-family: 'Inter', sans-serif;
                        background-color: #f7fafc;
                }

                .game-board {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                        gap: 1rem;
                        padding: 1rem;
                        max-width: 900px;
                        margin: 0 auto;
                }

                .card-container {
                        perspective: 1000px;
                        height: 80px;
                        width: 100%;
                        cursor: pointer;
                        position: relative;
                }

                .card {
                        width: 100%;
                        height: 100%;
                        position: absolute;
                        transform-style: preserve-3d;
                        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                        border-radius: 0.75rem;
                        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
                }

                .card.is-flipped {
                        transform: rotateY(180deg);
                }

                .card-face {
                        position: absolute;
                        width: 100%;
                        height: 100%;
                        backface-visibility: hidden;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 2.5rem;
                        font-weight: bold;
                        border-radius: 0.75rem;
                        padding: 0.5rem;
                        user-select: none;
                }

                .card-face.front {
                        background-color: #f0fdf4;
                        color: #166534;
                        transform: rotateY(180deg);
                }

                .card-face.back {
                        background-color: #3b82f6;
                        color: #ffffff;
                        font-size: 1.5rem;
                        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                }

                /* --- Styling for matched cards --- */
                .card.is-matched {
                        pointer-events: none;
                        /* Disable clicks on matched cards */
                }

                .card.is-matched .card-face.front {
                        background-color: #d1fae5;
                        /* A light green to indicate a match */
                        color: #065f46;
                        border: 2px solid #34d399;
                        /* Add a green border for emphasis */
                }

                /* Styles for the multiple selection */
                .selection-grid {
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 0.5rem;
                }

                .selection-label {
                        display: flex;
                        align-items: center;
                        padding: 0.5rem;
                        background-color: #e2e8f0;
                        border-radius: 0.5rem;
                        cursor: pointer;
                        transition: background-color 0.2s;
                }

                .selection-label:hover {
                        background-color: #cbd5e1;
                }

                .selection-label input[type="checkbox"] {
                        margin-right: 0.5rem;
                }

                @media (min-width: 640px) {
                        .selection-grid {
                                grid-template-columns: repeat(3, 1fr);
                        }
                }

                @media (min-width: 768px) {
                        .selection-grid {
                                grid-template-columns: repeat(4, 1fr);
                        }
                }

                @media (min-width: 1024px) {
                        .selection-grid {
                                grid-template-columns: repeat(5, 1fr);
                        }
                }


                @media (max-width: 768px) {
                        .card-face {
                                font-size: 1rem;
                        }

                        .card-face.back {
                                font-size: 1.25rem;
                        }
                }

                @media (max-width: 480px) {
                        .card-face {
                                font-size: 0.8rem;
                        }

                        .card-face.back {
                                font-size: 1rem;
                        }
                }
        </style>
</head>

<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-4xl w-full">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 text-center sm:text-left w-full mb-4 sm:mb-0"
                                id="game-title">Hiragana Memory Game</h1>
                        <div class="text-2xl sm:text-3xl font-bold text-gray-700" id="timer"></div>
                </div>
                <p class="text-center text-gray-600 mb-6" id="game-instruction">Ghép các cặp ký tự Hiragana và Romanji
                        tương ứng!</p>

                <div class="bg-gray-200 p-4 rounded-xl mb-6">
                        <h3 class="text-lg font-bold mb-2">Chọn chế độ:</h3>
                        <div class="flex space-x-4 mb-4">
                                <label class="flex items-center">
                                        <input type="radio" name="script-mode" value="hiragana" checked
                                                class="form-radio text-blue-600">
                                        <span class="ml-2">Hiragana</span>
                                </label>
                                <label class="flex items-center">
                                        <input type="radio" name="script-mode" value="katakana"
                                                class="form-radio text-blue-600">
                                        <span class="ml-2">Katakana</span>
                                </label>
                        </div>

                        <h3 class="text-lg font-bold mb-2">Chọn nhóm ký tự:</h3>
                        <div id="selection-options" class="selection-grid">
                                <!-- Checkboxes will be dynamically added here -->
                        </div>
                </div>

                <div class="flex justify-center mb-6">
                        <button id="start-game-button"
                                class="px-6 py-3 bg-blue-500 text-white font-bold rounded-xl shadow-lg hover:bg-blue-600 transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                                Bắt đầu trò chơi
                        </button>
                </div>

                <div class="message-box bg-blue-100 text-blue-800 p-4 rounded-xl text-center font-semibold mb-6 hidden"
                        id="message-box">
                        Nhấp vào một thẻ để bắt đầu.
                </div>

                <div class="game-board" id="game-board">
                        <!-- Cards will be dynamically inserted here by JavaScript -->
                </div>

                <div class="flex justify-center mt-6">
                        <button id="restart-button"
                                class="px-6 py-3 bg-green-500 text-white font-bold rounded-xl shadow-lg hover:bg-green-600 transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 hidden">
                                Chơi lại
                        </button>
                </div>
        </div>

        <script>
                document.addEventListener('DOMContentLoaded', () => {
                        // Game variables and state
                        const gameBoard = document.getElementById('game-board');
                        const messageBox = document.getElementById('message-box');
                        const startButton = document.getElementById('start-game-button');
                        const restartButton = document.getElementById('restart-button');
                        const timerDisplay = document.getElementById('timer');
                        const selectionOptionsContainer = document.getElementById('selection-options');
                        const scriptModeRadios = document.querySelectorAll('input[name="script-mode"]');
                        const gameTitleElement = document.getElementById('game-title');
                        const gameInstructionElement = document.getElementById('game-instruction');

                        let cards = [];
                        let hasFlippedCard = false;
                        let lockBoard = false;
                        let firstCard, secondCard;
                        let matchedPairs = 0;
                        let pairsPerGame = 0;
                        let timer = null;
                        let seconds = 0;
                        let minutes = 0;

                        // --- Hiragana and Katakana Data ---
                        const allHiraganaPairs = [
                                { id: 1, value: 'あ', romanji: 'a', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 2, value: 'い', romanji: 'i', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 3, value: 'う', romanji: 'u', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 4, value: 'え', romanji: 'e', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 5, value: 'お', romanji: 'o', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 6, value: 'か', romanji: 'ka', group: 'k-group', groupName: 'Hàng K' },
                                { id: 7, value: 'き', romanji: 'ki', group: 'k-group', groupName: 'Hàng K' },
                                { id: 8, value: 'く', romanji: 'ku', group: 'k-group', groupName: 'Hàng K' },
                                { id: 9, value: 'け', romanji: 'ke', group: 'k-group', groupName: 'Hàng K' },
                                { id: 10, value: 'こ', romanji: 'ko', group: 'k-group', groupName: 'Hàng K' },
                                { id: 11, value: 'さ', romanji: 'sa', group: 's-group', groupName: 'Hàng S' },
                                { id: 12, value: 'し', romanji: 'shi', group: 's-group', groupName: 'Hàng S' },
                                { id: 13, value: 'す', romanji: 'su', group: 's-group', groupName: 'Hàng S' },
                                { id: 14, value: 'せ', romanji: 'se', group: 's-group', groupName: 'Hàng S' },
                                { id: 15, value: 'そ', romanji: 'so', group: 's-group', groupName: 'Hàng S' },
                                { id: 16, value: 'た', romanji: 'ta', group: 't-group', groupName: 'Hàng T' },
                                { id: 17, value: 'ち', romanji: 'chi', group: 't-group', groupName: 'Hàng T' },
                                { id: 18, value: 'つ', romanji: 'tsu', group: 't-group', groupName: 'Hàng T' },
                                { id: 19, value: 'て', romanji: 'te', group: 't-group', groupName: 'Hàng T' },
                                { id: 20, value: 'と', romanji: 'to', group: 't-group', groupName: 'Hàng T' },
                                { id: 21, value: 'な', romanji: 'na', group: 'n-group', groupName: 'Hàng N' },
                                { id: 22, value: 'に', romanji: 'ni', group: 'n-group', groupName: 'Hàng N' },
                                { id: 23, value: 'ぬ', romanji: 'nu', group: 'n-group', groupName: 'Hàng N' },
                                { id: 24, value: 'ね', romanji: 'ne', group: 'n-group', groupName: 'Hàng N' },
                                { id: 25, value: 'の', romanji: 'no', group: 'n-group', groupName: 'Hàng N' },
                                { id: 26, value: 'は', romanji: 'ha', group: 'h-group', groupName: 'Hàng H' },
                                { id: 27, value: 'ひ', romanji: 'hi', group: 'h-group', groupName: 'Hàng H' },
                                { id: 28, value: 'ふ', romanji: 'fu', group: 'h-group', groupName: 'Hàng H' },
                                { id: 29, value: 'へ', romanji: 'he', group: 'h-group', groupName: 'Hàng H' },
                                { id: 30, value: 'ほ', romanji: 'ho', group: 'h-group', groupName: 'Hàng H' },
                                { id: 31, value: 'ま', romanji: 'ma', group: 'm-group', groupName: 'Hàng M' },
                                { id: 32, value: 'み', romanji: 'mi', group: 'm-group', groupName: 'Hàng M' },
                                { id: 33, value: 'む', romanji: 'mu', group: 'm-group', groupName: 'Hàng M' },
                                { id: 34, value: 'め', romanji: 'me', group: 'm-group', groupName: 'Hàng M' },
                                { id: 35, value: 'も', romanji: 'mo', group: 'm-group', groupName: 'Hàng M' },
                                { id: 36, value: 'や', romanji: 'ya', group: 'y-group', groupName: 'Hàng Y' },
                                { id: 37, value: 'ゆ', romanji: 'yu', group: 'y-group', groupName: 'Hàng Y' },
                                { id: 38, value: 'よ', romanji: 'yo', group: 'y-group', groupName: 'Hàng Y' },
                                { id: 39, value: 'ら', romanji: 'ra', group: 'r-group', groupName: 'Hàng R' },
                                { id: 40, value: 'り', romanji: 'ri', group: 'r-group', groupName: 'Hàng R' },
                                { id: 41, value: 'る', romanji: 'ru', group: 'r-group', groupName: 'Hàng R' },
                                { id: 42, value: 'れ', romanji: 're', group: 'r-group', groupName: 'Hàng R' },
                                { id: 43, value: 'ろ', romanji: 'ro', group: 'r-group', groupName: 'Hàng R' },
                                { id: 44, value: 'わ', romanji: 'wa', group: 'w-group', groupName: 'Hàng W' },
                                { id: 45, value: 'を', romanji: 'wo', group: 'w-group', groupName: 'Hàng W' },
                                { id: 46, value: 'ん', romanji: 'n', group: 'w-group', groupName: 'Hàng W' },
                        ];

                        const allKatakanaPairs = [
                                { id: 101, value: 'ア', romanji: 'a', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 102, value: 'イ', romanji: 'i', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 103, value: 'ウ', romanji: 'u', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 104, value: 'エ', romanji: 'e', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 105, value: 'オ', romanji: 'o', group: 'vowels', groupName: 'Nguyên âm' },
                                { id: 106, value: 'カ', romanji: 'ka', group: 'k-group', groupName: 'Hàng K' },
                                { id: 107, value: 'キ', romanji: 'ki', group: 'k-group', groupName: 'Hàng K' },
                                { id: 108, value: 'ク', romanji: 'ku', group: 'k-group', groupName: 'Hàng K' },
                                { id: 109, value: 'ケ', romanji: 'ke', group: 'k-group', groupName: 'Hàng K' },
                                { id: 110, value: 'コ', romanji: 'ko', group: 'k-group', groupName: 'Hàng K' },
                                { id: 111, value: 'サ', romanji: 'sa', group: 's-group', groupName: 'Hàng S' },
                                { id: 112, value: 'シ', romanji: 'shi', group: 's-group', groupName: 'Hàng S' },
                                { id: 113, value: 'ス', romanji: 'su', group: 's-group', groupName: 'Hàng S' },
                                { id: 114, value: 'セ', romanji: 'se', group: 's-group', groupName: 'Hàng S' },
                                { id: 115, value: 'ソ', romanji: 'so', group: 's-group', groupName: 'Hàng S' },
                                { id: 116, value: 'タ', romanji: 'ta', group: 't-group', groupName: 'Hàng T' },
                                { id: 117, value: 'チ', romanji: 'chi', group: 't-group', groupName: 'Hàng T' },
                                { id: 118, value: 'ツ', romanji: 'tsu', group: 't-group', groupName: 'Hàng T' },
                                { id: 119, value: 'テ', romanji: 'te', group: 't-group', groupName: 'Hàng T' },
                                { id: 120, value: 'ト', romanji: 'to', group: 't-group', groupName: 'Hàng T' },
                                { id: 121, value: 'ナ', romanji: 'na', group: 'n-group', groupName: 'Hàng N' },
                                { id: 122, value: 'ニ', romanji: 'ni', group: 'n-group', groupName: 'Hàng N' },
                                { id: 123, value: 'ヌ', romanji: 'nu', group: 'n-group', groupName: 'Hàng N' },
                                { id: 124, value: 'ネ', romanji: 'ne', group: 'n-group', groupName: 'Hàng N' },
                                { id: 125, value: 'ノ', romanji: 'no', group: 'n-group', groupName: 'Hàng N' },
                                { id: 126, value: 'ハ', romanji: 'ha', group: 'h-group', groupName: 'Hàng H' },
                                { id: 127, value: 'ヒ', romanji: 'hi', group: 'h-group', groupName: 'Hàng H' },
                                { id: 128, value: 'フ', romanji: 'fu', group: 'h-group', groupName: 'Hàng H' },
                                { id: 129, value: 'ヘ', romanji: 'he', group: 'h-group', groupName: 'Hàng H' },
                                { id: 130, value: 'ホ', romanji: 'ho', group: 'h-group', groupName: 'Hàng H' },
                                { id: 131, value: 'マ', romanji: 'ma', group: 'm-group', groupName: 'Hàng M' },
                                { id: 132, value: 'ミ', romanji: 'mi', group: 'm-group', groupName: 'Hàng M' },
                                { id: 133, value: 'ム', romanji: 'mu', group: 'm-group', groupName: 'Hàng M' },
                                { id: 134, value: 'メ', romanji: 'me', group: 'm-group', groupName: 'Hàng M' },
                                { id: 135, value: 'モ', romanji: 'mo', group: 'm-group', groupName: 'Hàng M' },
                                { id: 136, value: 'ヤ', romanji: 'ya', group: 'y-group', groupName: 'Hàng Y' },
                                { id: 137, value: 'ユ', romanji: 'yu', group: 'y-group', groupName: 'Hàng Y' },
                                { id: 138, value: 'ヨ', romanji: 'yo', group: 'y-group', groupName: 'Hàng Y' },
                                { id: 139, value: 'ラ', romanji: 'ra', group: 'r-group', groupName: 'Hàng R' },
                                { id: 140, value: 'リ', romanji: 'ri', group: 'r-group', groupName: 'Hàng R' },
                                { id: 141, value: 'ル', romanji: 'ru', group: 'r-group', groupName: 'Hàng R' },
                                { id: 142, value: 'レ', romanji: 're', group: 'r-group', groupName: 'Hàng R' },
                                { id: 143, value: 'ロ', romanji: 'ro', group: 'r-group', groupName: 'Hàng R' },
                                { id: 144, value: 'ワ', romanji: 'wa', group: 'w-group', groupName: 'Hàng W' },
                                { id: 145, value: 'ヲ', romanji: 'wo', group: 'w-group', groupName: 'Hàng W' },
                                { id: 46, value: 'ン', romanji: 'n', group: 'w-group', groupName: 'Hàng W' },
                        ];

                        // Mapping for selection options
                        const selectionGroups = [
                                { id: 'all', name: 'Tất cả' },
                                { id: 'vowels', name: 'Nguyên âm' },
                                { id: 'k-group', name: 'Hàng K' },
                                { id: 's-group', name: 'Hàng S' },
                                { id: 't-group', name: 'Hàng T' },
                                { id: 'n-group', name: 'Hàng N' },
                                { id: 'h-group', name: 'Hàng H' },
                                { id: 'm-group', name: 'Hàng M' },
                                { id: 'y-group', name: 'Hàng Y' },
                                { id: 'r-group', name: 'Hàng R' },
                                { id: 'w-group', name: 'Hàng W' },
                        ];

                        // Function to start the timer
                        function startTimer() {
                                if (timer) return; // Prevent multiple timers from running
                                timer = setInterval(() => {
                                        seconds++;
                                        if (seconds === 60) {
                                                seconds = 0;
                                                minutes++;
                                        }
                                        const formattedMinutes = String(minutes).padStart(2, '0');
                                        const formattedSeconds = String(seconds).padStart(2, '0');
                                        timerDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
                                }, 1000);
                        }

                        // Function to stop the timer
                        function stopTimer() {
                                clearInterval(timer);
                                timer = null;
                        }

                        // Render selection options based on the selected script mode
                        function renderSelectionOptions() {
                                selectionOptionsContainer.innerHTML = '';
                                selectionGroups.forEach(group => {
                                        const label = document.createElement('label');
                                        label.classList.add('selection-label');
                                        const checkbox = document.createElement('input');
                                        checkbox.type = 'checkbox';
                                        checkbox.value = group.id;
                                        checkbox.name = 'kana-group';
                                        if (group.id === 'vowels') {
                                                checkbox.checked = true; // Select a default group
                                        }
                                        const span = document.createElement('span');
                                        span.textContent = group.name;

                                        label.appendChild(checkbox);
                                        label.appendChild(span);
                                        selectionOptionsContainer.appendChild(label);
                                });

                                // Add event listener for the "Tất cả" checkbox
                                const allCheckbox = document.querySelector('input[value="all"]');
                                const otherCheckboxes = document.querySelectorAll('input[name="kana-group"]:not([value="all"])');

                                if (allCheckbox) {
                                        allCheckbox.addEventListener('change', (event) => {
                                                const isChecked = event.target.checked;
                                                otherCheckboxes.forEach(cb => {
                                                        cb.checked = isChecked;
                                                });
                                        });
                                }

                                // Add event listener to other checkboxes to manage the "Tất cả" state
                                otherCheckboxes.forEach(cb => {
                                        cb.addEventListener('change', () => {
                                                const allOthersChecked = Array.from(otherCheckboxes).every(c => c.checked);
                                                if (allCheckbox) {
                                                        allCheckbox.checked = allOthersChecked;
                                                }
                                        });
                                });
                        }

                        // Function to handle script mode change (Hiragana/Katakana)
                        function handleScriptModeChange() {
                                const selectedMode = document.querySelector('input[name="script-mode"]:checked').value;

                                if (selectedMode === 'hiragana') {
                                        gameTitleElement.textContent = 'Hiragana Memory Game';
                                        document.title = 'Hiragana Memory Game';
                                        gameInstructionElement.textContent = 'Ghép các cặp ký tự Hiragana và Romanji tương ứng!';
                                } else {
                                        gameTitleElement.textContent = 'Katakana Memory Game';
                                        document.title = 'Katakana Memory Game';
                                        gameInstructionElement.textContent = 'Ghép các cặp ký tự Katakana và Romanji tương ứng!';
                                }
                                // Re-render selection options in case we want different groups for each script in the future
                                renderSelectionOptions();
                        }

                        // Initialize the game board
                        function initializeBoard() {
                                // Hide selection options and show game UI
                                selectionOptionsContainer.parentElement.classList.add('hidden');
                                document.querySelector('.bg-gray-200 > .flex').classList.add('hidden'); // Hide the script mode selection
                                startButton.classList.add('hidden');
                                messageBox.classList.remove('hidden');
                                restartButton.classList.remove('hidden');

                                // Stop and reset timer
                                stopTimer();
                                seconds = 0;
                                minutes = 0;
                                timerDisplay.textContent = '00:00';

                                // Get the selected script mode and corresponding data
                                const selectedMode = document.querySelector('input[name="script-mode"]:checked').value;
                                const selectedPairsData = selectedMode === 'hiragana' ? allHiraganaPairs : allKatakanaPairs;

                                // Get selected ranges and filter pairs
                                const selectedCheckboxes = document.querySelectorAll('input[name="kana-group"]:checked');
                                let selectedGroups = Array.from(selectedCheckboxes).map(cb => cb.value);

                                // Filter out the 'all' option from the selected groups
                                const nonAllSelectedGroups = selectedGroups.filter(g => g !== 'all');

                                // If 'all' is selected, use all groups. Otherwise, use the selected ones.
                                const groupsToUse = selectedGroups.includes('all') || nonAllSelectedGroups.length === 0 ?
                                        selectionGroups.filter(g => g.id !== 'all').map(g => g.id) :
                                        nonAllSelectedGroups;

                                // Filter the main array based on the selected group IDs
                                let pairsToUse = selectedPairsData.filter(pair => groupsToUse.includes(pair.group));

                                // Shuffle and select pairs if there are too many for the board
                                if (pairsToUse.length > 20) { // Limit to 20 pairs for a reasonable board size
                                        pairsToUse = pairsToUse.sort(() => Math.random() - 0.5).slice(0, 20);
                                }

                                pairsPerGame = pairsToUse.length;
                                if (pairsPerGame === 0) {
                                        messageBox.textContent = 'Vui lòng chọn ít nhất một nhóm ký tự để bắt đầu!';
                                        return;
                                }

                                // Combine hiragana and romanji into a single array for the game board
                                const gameContent = pairsToUse.flatMap(pair => [
                                        { pairId: pair.id, type: 'kana', value: pair.value },
                                        { pairId: pair.id, type: 'romanji', value: pair.romanji }
                                ]);

                                // Shuffle the cards again
                                gameContent.sort(() => Math.random() - 0.5);

                                // Clear the existing board
                                gameBoard.innerHTML = '';

                                // Create and append the card elements to the board
                                gameContent.forEach(cardData => {
                                        const cardContainer = document.createElement('div');
                                        cardContainer.classList.add('card-container');
                                        cardContainer.dataset.pairId = cardData.pairId;
                                        cardContainer.dataset.value = cardData.value;
                                        cardContainer.dataset.type = cardData.type;

                                        const cardElement = document.createElement('div');
                                        cardElement.classList.add('card');

                                        const cardFront = document.createElement('div');
                                        cardFront.classList.add('card-face', 'front');
                                        cardFront.textContent = cardData.value;

                                        const cardBack = document.createElement('div');
                                        cardBack.classList.add('card-face', 'back');
                                        cardBack.textContent = '?';

                                        cardElement.appendChild(cardFront);
                                        cardElement.appendChild(cardBack);
                                        cardContainer.appendChild(cardElement);
                                        gameBoard.appendChild(cardContainer);
                                });

                                // Attach event listeners to the cards
                                cards = document.querySelectorAll('.card-container');
                                cards.forEach(card => card.addEventListener('click', flipCard));
                                messageBox.textContent = 'Nhấp vào một thẻ để bắt đầu.';

                                // Reset game state
                                matchedPairs = 0;
                                resetBoard();
                        }

                        // Function to handle a card click
                        function flipCard() {
                                // If the board is locked or the same card is clicked, do nothing
                                if (lockBoard) return;
                                if (this === firstCard) return;

                                // Start the timer on the first card flip
                                if (!hasFlippedCard && !timer) {
                                        startTimer();
                                }

                                // Get the card element and flip it
                                const cardElement = this.querySelector('.card');
                                cardElement.classList.add('is-flipped');

                                if (!hasFlippedCard) {
                                        // First card clicked
                                        hasFlippedCard = true;
                                        firstCard = this;
                                        return;
                                }

                                // Second card clicked
                                secondCard = this;
                                lockBoard = true;

                                // Check for a match
                                checkForMatch();
                        }

                        // Function to check if the two flipped cards are a match
                        function checkForMatch() {
                                const isMatch = firstCard.dataset.pairId === secondCard.dataset.pairId;

                                if (isMatch) {
                                        disableCards();
                                } else {
                                        unflipCards();
                                }
                        }

                        // Cards match, keep them flipped
                        function disableCards() {
                                // Add the 'is-matched' class to the card elements to indicate a permanent match
                                firstCard.querySelector('.card').classList.add('is-matched');
                                secondCard.querySelector('.card').classList.add('is-matched');

                                // Remove the event listeners to prevent further clicks on these cards
                                firstCard.removeEventListener('click', flipCard);
                                secondCard.removeEventListener('click', flipCard);

                                // Increment matched pairs and check for a win
                                matchedPairs++;
                                if (matchedPairs === pairsPerGame) {
                                        stopTimer();
                                        const finalTime = timerDisplay.textContent;
                                        messageBox.textContent = `Chúc mừng, bạn đã chiến thắng trong ${finalTime}!`;
                                        restartButton.textContent = 'Chơi lại?';
                                } else {
                                        messageBox.textContent = 'Chúc mừng! Tìm cặp tiếp theo.';
                                }
                                resetBoard();
                        }

                        // Cards do not match, unflip them after a delay
                        function unflipCards() {
                                lockBoard = true;
                                messageBox.textContent = 'Không khớp, hãy thử lại.';

                                setTimeout(() => {
                                        firstCard.querySelector('.card').classList.remove('is-flipped');
                                        secondCard.querySelector('.card').classList.remove('is-flipped');
                                        resetBoard();
                                }, 1500); // Wait for 1.5 seconds before flipping back
                        }

                        // Reset the card state for the next turn
                        function resetBoard() {
                                [hasFlippedCard, lockBoard] = [false, false];
                                [firstCard, secondCard] = [null, null];
                        }

                        // Event listener for the restart button and start button
                        startButton.addEventListener('click', initializeBoard);
                        restartButton.addEventListener('click', () => {
                                location.reload(); // Reload the page to reset everything
                        });

                        // Listen for changes in the script mode radio buttons
                        scriptModeRadios.forEach(radio => {
                                radio.addEventListener('change', handleScriptModeChange);
                        });

                        // Initial setup
                        handleScriptModeChange();
                });
        </script>
</body>

</html>
